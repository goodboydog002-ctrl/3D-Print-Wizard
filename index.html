<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>3D Print Wizard</title>
  <style>
    :root{--bg:#0b0d12;--fg:#e9edf1;--muted:#a9b3bd;--card:#12151d;--accent:#7ac7ff;--line:#1c2333}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;background:var(--bg);color:var(--fg)}
    header{padding:16px 20px;border-bottom:1px solid var(--line);display:flex;align-items:center;justify-content:space-between}
    h1{font-size:20px;margin:0}
    main{display:grid;grid-template-columns:360px 1fr;min-height:calc(100vh - 60px)}
    aside{border-right:1px solid var(--line);padding:16px;background:var(--card)}
    section.viewer{position:relative}
    canvas{display:block;width:100%;height:100%}
    label{display:block;margin:12px 0 6px;font-weight:600}
    textarea,input,select{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--line);background:#0f131b;color:var(--fg)}
    textarea{min-height:120px;resize:vertical}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    button,.btn{appearance:none;border:0;background:var(--accent);color:#001222;font-weight:700;padding:10px 14px;border-radius:10px;cursor:pointer}
    .subtle{background:#20283a;color:var(--fg)}
    .muted{color:var(--muted);font-size:12px}
    .tooltip{font-size:12px;color:var(--muted);margin-top:-6px;margin-bottom:8px}
    footer{padding:10px 16px;border-top:1px solid var(--line);font-size:12px;color:var(--muted)}
  </style>

  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.161.0/build/three.module.js",
      "three/addons/": "https://unpkg.com/three@0.161.0/examples/jsm/"
    }
  }
  </script>

  <script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
    import { STLExporter } from 'three/addons/exporters/STLExporter.js';

    const renderer = new THREE.WebGLRenderer({ antialias:true });
    const viewer = document.createElement('div');
    viewer.style.position='absolute';viewer.style.inset='0';
    document.addEventListener('DOMContentLoaded',()=>{
      document.querySelector('.viewer').appendChild(viewer);
      viewer.appendChild(renderer.domElement);
      onResize();
      window.addEventListener('resize', onResize);
      animate();
    });

    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x0b0d12);
    const camera = new THREE.PerspectiveCamera(50, 2, 0.1, 1000);
    camera.position.set(120, 100, 140);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;

    const hemi = new THREE.HemisphereLight(0xffffff, 0x222233, 0.8);
    scene.add(hemi);
    const dir = new THREE.DirectionalLight(0xffffff, 0.9);
    dir.position.set(120,180,100);
    scene.add(dir);

    const grid = new THREE.GridHelper(400, 40, 0x1c2333, 0x1c2333);
    grid.position.y = 0;
    scene.add(grid);

    let currentObject = null;

    function clearCurrent(){
      if(currentObject){ scene.remove(currentObject); currentObject = null; }
    }

    function onResize(){
      const w = viewer.clientWidth || window.innerWidth;
      const h = viewer.clientHeight || (window.innerHeight-60);
      renderer.setSize(w, h, false);
      camera.aspect = w/h;
      camera.updateProjectionMatrix();
    }

    function animate(){
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }

    const exporter = new STLExporter();
    function downloadSTL(obj, name='model', unit='mm'){
      const geo = obj.geometry.clone();
      if(unit==='in') geo.scale(25.4,25.4,25.4);
      const scaledMesh = new THREE.Mesh(geo, obj.material);
      const data = exporter.parse(scaledMesh, { binary:true });
      const blob = new Blob([data], { type:'application/octet-stream' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${name}.stl`;
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>
</head>
<body>
  <header>
    <h1>3D Print Wizard</h1>
    <div class="muted">Generate or view 3D print files (STL/OBJ/GLTF). Everything runs in your browser.</div>
  </header>
  <main>
    <aside>
      <div class="row" style="margin-bottom:6px">
        <label for="unitSelect">Units:</label>
        <select id="unitSelect">
          <option value="mm" selected>Millimeters (mm)</option>
          <option value="in">Inches (in)</option>
        </select>
      </div>
      <div class="tooltip">Tip: 1 inch = 25.4 millimeters. Choose units carefully for accurate 3D printing.</div>
    </aside>
    <section class="viewer"></section>
  </main>
  <footer>
    3D Print Wizard · No servers required · Choose export unit for printing accuracy.
  </footer>
</body>
</html>